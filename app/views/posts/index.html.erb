<div class="d-flex flex-row justify-content-center">
  <div class="p-2">
    <div class = "card bg-light mb-3" style="width: 32rem;" >
      <div class = "card-body">
      <%= render "form", post: @post%> <!--brings new form to index-->
      </div>
    </div>

  </div>
     <% @posts.each do |post| %>
        <% owner = post.user %>
        <article class = "card bg-light mb-3" style="width: 32rem;">

            <div class = "card-body border-top">
              <div class="card-title">
                <h5><%= "#{post.user.username}"%></h5>
                <p><small> <%= "#{distance_of_time_in_words(Time.now, post.created_at, include_seconds: true)} ago"%> </small></p>
              </div>
              
              <div class = "card-text">
                <h1><strong><%= post.message %></strong></h1>
              </div>

              <div class="card-body">
                <div>
                  <% if post.image.attached? %>
                    <%= image_tag(post.image) %>
                  <% end %>
                </div>
              </div>          
                
              <div class="card-link">              
                <% pre_like = post.likes.find { |like| like.user_id == current_user.id} %>
                  <% if pre_like %>
                    <%= link_to 'Unlike', post_like_path(post, pre_like), method: :delete %>
                  <% else %>
                    <%= link_to 'Like', post_likes_path(post), method: :post %>
                  <% end %>

                <% if current_user == owner%>
                <%= link_to "Edit", edit_post_path(post) %> 
                <%= link_to "Delete", post_path(post), method: :delete, data: { confirm: 'Are you sure?' } %> 
                <% end %>
              <p><%= post.likes.count %> <%= (post.likes.count) == 1 ? 'Like' : 'Likes'%></p>
              </div>
            </div>
              
            <div class = "card-body border-top">
              <strong>Comments:</strong>
              <%= render post.comments, owner: owner%>           
              <%= bootstrap_form_with model: [ post, post.comments.build ], local: true do |form| %>
                      <%= form.text_field :content, placeholder: "Write a comment...", skip_label: true, id:"content", :rows=>1, :cols=>20 %>
                      <%=form.submit "Comment", id:"create_comment"%>
              <% end %>
            </div>
          
          </article>
      <% end %>
  </div>


  <div class="container text-center">
    <div id='friends-requests' class="p-2">
      <h3>Requests</h3>
      <ul>
        <% for friendship in @friendships %>
          <% if friendship.accepted == false %>
            <% if current_user.id == friendship.friend_id %>
            <li>
              <%= User.find(friendship.user_id).username %>
                <%= link_to "Accept", friendship, :method => :patch %>
                (<%= link_to "Reject", friendship, :method => :delete %>)
            </li>
            <% end %>
          <% end %>
        <% end %>  
        </ul>
    </div>

    <div id="friends-list" class="p-2">
      <h3>Contacts</h3>
        <ul>
          <% for friendship in @friendships %>
            <% if friendship.accepted == true %>
              <li>
                <% if current_user.id == friendship.user_id %>
                  <%= User.find(friendship.friend_id).username %>
                  (<%= link_to "Remove", friendship, :method => :delete %>)

                <% elsif current_user.id == friendship.friend_id %>
                  <%= User.find(friendship.user_id).username %>
                  (<%= link_to "Remove", friendship, :method => :delete %>)
                <% end %>

              </li>
            <% end %>
          <% end %>  
        </ul>
    </div>
</div>
</div>
<%= raw pagy_bootstrap_nav(@pagy) %>